<!DOCTYPE html>
<html>
<head>
	<title>Equipement Salle Blanche</title>
	<link rel="stylesheet" type="text/css" href="popup.css">
</head>
<body>
<h1 style="margin-left:50px">Equipement Salle Blanche</h1>


<div id="layer_1"> <!-- Equipement -->

	<img src="plan_SB_V02_img\Equipment.png" 				width="4000px" style="position: absolute; left:0px;top:0px;"/>
	<div style="position: absolute; background: green; width:20px; height: 20px; left: 70px; top : 100px; text-align: center">✓</div>
	
	<button type="button" onclick="desactivate_popup(1)" style="position:absolute; left:100px; top:150px; z-index : 1;">Desactiver PopUp</button>

</div>
<div id="layer_2"> <!-- Raster -->

	<img src="plan_SB_V02_img\Raster.png" 					width="4000px" style="position: absolute; left:0px;top:0px;"/>
	<div style="position: absolute; background: green; width:20px; height: 20px; left: 70px; top : 125px; text-align: center">✓</div>


</div>
<div id="layer_99"> <!-- Formulaire nouveau equipment -->
	<form style="position:absolute; left:20px; top:300px; z-index : 1" action="#">

	<table>
		<tr>
			<td><label for="form_field_name">Nom Machine</label></td>
			<td><input type="text" id="form_field_name" name="form_field_name"style="width:300px"></td>
		</tr><tr>
			<td><label for="form_field_point">Points du Polygon</label></td>
			<td><input type="text" id="form_field_point" name="form_field_point"style="width:300px"></td>
		</tr><tr>
			<td><label for="form_field_zone">Zone</label></td>
			<td><input type="number" id="form_field_zone" name="form_field_zone" style="width:300px"></td>
		</tr><tr>
			<td><label for="form_field_picture">Chemin image</label></td>
			<td><input type="text" id="form_field_picture" name="form_field_picture"style="width:300px"></td>
		</tr><tr>
			<td><label for="form_field_picture_width">Largeur image</label></td>
			<td><input type="number" id="form_field_picture_width" name="form_field_picture_width" style="width:300px" value="500"></td>
		</tr><tr>
			<td><label for="form_button_generate">Generer</label></td>
			<td><input type="button" id="form_button_generate" name="form_button_generate" value="Start" onclick="generate_json()"></td>
		</tr><tr>
			<td><label for="form_button_reset">Recommencer</label></td>
			<td><input type="button" id="form_button_reset" name="form_button_reset" value="Reset" onclick="reset_form()"></td>
		</tr>
	</table>
	<!-- </td><td> -->
	<label for="form_field_description">Description</label><br/>
	<textarea id="form_field_description" name="form_field_description" rows="7" cols="30"></textarea><br/>

	<label for="form_field_media">Médias</label><br/>
	<textarea id="form_field_media" name="form_field_media" rows="7" cols="30"></textarea><br/>
	<div id="tablecell_return_text"></div>
				
	</form>

	<div style="position: absolute; background: green; width:20px; height: 20px; left: 70px; top : 175px; text-align: center">✓</div>
	
		<svg width="4000" height="2250" id="svg_polygon" style="position: absolute; left:0px;top:0px;">
		<polygon points="" style="fill:rgba(0,0,100,0.5); stroke:black; stroke-width:1" />
	</svg>
	
	
</div>
<div id="layer_0"> <!-- Fond de Plan -->

	<img src="plan_SB_V02_img\SalleBlanche.png" 					name="SB"  id="plan"		width="4000px" style="position: absolute; left:0px;top:0px;"usemap="#enabled_map_equ"/>
	
	<map name="enabled_map_equ" id="map_equ_1"></map>
	
</div>






<button type="button" onclick="toggle_layer(1)" style="position:absolute; left:100px; top:100px;">Affichage équipement</button>
<button type="button" onclick="toggle_layer(2)" style="position:absolute; left:100px; top:125px;">Affichage raster</button>
<button type="button" onclick="toggle_layer(99)" style="position:absolute; left:100px; top:175px;">New equipment</button>





<script src="popup.js"></script>
<script src="https:////ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="equipment_data.json"></script>
<script type="text/javascript">

var scope = {};
var elem_svg_polygon = document.getElementById("svg_polygon")



window.onload = function() {
	/* Generation des champs cliquable sur le plan, Balise "map" html */
	Generate_Map_HTML()
	toggle_layer(2)
	toggle_layer(99)
	/* Fonction fabrication polygon & generation champ "Points du polygon" */
		
	$('#plan').bind('click', function (ev) {
		var $img = $(ev.target);

		var offset = $img.offset(); 

		var x = ev.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - offset.left
		var y = ev.clientY + document.body.scrollTop  + document.documentElement.scrollTop  - offset.top;
		
		var svgNS = "http://www.w3.org/2000/svg"; 
		var new_point = document.createElementNS(svgNS, "circle")
		new_point.setAttributeNS(null, "cx", x)
		new_point.setAttributeNS(null, "cy", y)
		new_point.setAttributeNS(null, "r", "2")
		new_point.setAttributeNS(null, "stroke", "black")
		new_point.setAttributeNS(null, "stroke-width", "1")
		new_point.setAttributeNS(null, "fill", "red")
		
		elem_svg_polygon.appendChild(new_point);
		var polygon = document.getElementsByTagName("polygon");
		polygon[0].setAttributeNS(null, "points", polygon[0].getAttribute("points")+x+","+y+",")/* , "220,10 300,210 170,250 123,234" */
		
		document.getElementById("form_field_point").value = polygon[0].getAttribute("points")
		
		console.log('clicked at x: ' + x + ', y: ' + y);
	});
}


function Generate_Map_HTML(){
	var elem_map_equ = document.getElementById("map_equ_1")
	for(var i = 0; i < equList.length; i++){
		var newMapLine = document.createElement("area");
		
		newMapLine.setAttribute("shape",   "poly");
		newMapLine.setAttribute("coords",    equList[i].points);
		newMapLine.setAttribute("href",    "javascript:;");
		newMapLine.setAttribute("onclick", "popup_equ("+i+")");
		
		elem_map_equ.appendChild(newMapLine);
		
	};
}







/* Generation du PopUp*/
function popup_equ(i) {
	// create a popup instance
	scope.detailPopup = new smq.Popup({
		title: equList[i].name+", (Zone "+equList[i].zone+")",
		innerHtml: '<img id="equ_img" width="'+equList[i].picturewidth+'" src="'+equList[i].picture+'"><hr>'+equList[i].description+'<hr>'+equList[i].media+'<hr>'
	});
	scope.detailPopup.show();
	$(document).on('keydown', function(event) {
		if (event.key == "Escape") {
			scope.detailPopup.close();
		}
	});
}

function toggle_layer(i){  
	var x = document.getElementById("layer_"+i);
	if (x.style.display === "none") {
		x.style.display = "block";
		var map = document.getElementById("map_equ_"+i)
		if(map != "undefined" && map != null){
			map.setAttribute("name","enabled_map_equ");
		}
	} else {
		x.style.display = "none";
		var map = document.getElementById("map_equ_"+i)
		if(map != "undefined" && map != null){
			map.setAttribute("name","disabled_map_equ");
		}
	}

}
function desactivate_popup(i){
	document.getElementById("map_equ_"+i).setAttribute("name","disabled_map_equ");
}





function generate_json(){
	var tablecell_return_text = document.getElementById("tablecell_return_text")
	var textarea = document.createElement("textarea")
	textarea.setAttribute("id", "form_field_media")
	textarea.setAttribute("name", "form_field_media")
	textarea.setAttribute("rows", "20")
	textarea.setAttribute("cols", "30")
	textarea.innerHTML  ='{\r\n'
	textarea.innerHTML +='\tname         : "'+document.getElementById("form_field_name").value         +'",\r\n'
	textarea.innerHTML +='\tpoints       : "'+document.getElementById("form_field_point").value        +'",\r\n'
	textarea.innerHTML +='\tzone         : "'+document.getElementById("form_field_zone").value         +'",\r\n'
	textarea.innerHTML +='\tpicture      : "'+document.getElementById("form_field_picture").value      +'",\r\n'
	textarea.innerHTML +='\tpicturewidth : "'+document.getElementById("form_field_picture_width").value+'",\r\n'
	textarea.innerHTML +='\tdescription  : "'+document.getElementById("form_field_description").value  +'",\r\n'
	textarea.innerHTML +='\tmedia        : "'+document.getElementById("form_field_media").value        +'",\r\n'
	textarea.innerHTML +='},\r\n'
	tablecell_return_text.appendChild(textarea)
	tablecell_return_text.innerHTML += "<br/>"
}
function reset_form(){
	document.getElementById("form_field_name").value=""
	document.getElementById("form_field_point").value=""
	document.getElementById("form_field_zone").value=""
	document.getElementById("form_field_picture").value=""
	document.getElementById("form_field_description").value=""
	document.getElementById("form_field_media").value=""
	var polygon = document.getElementsByTagName("polygon");
	polygon[0].setAttributeNS(null, "points", "")
	var circles = document.getElementsByTagName("circle");
	while(circles[0]){
		circles[0].parentNode.removeChild(circles[0])
	}
	
}


</script>

</body>
</html> 
